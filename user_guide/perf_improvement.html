<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Static Unit Coherence Checking and AST Modification &mdash; Impunity 0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contribute to impunity" href="../contribute.html" />
    <link rel="prev" title="Decorator Parameters" href="decorator_options.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Impunity
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#annotating-code-with-physical-units">Annotating Code with Physical Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user_guide.html#how-to-use-impunity">How to use <strong>Impunity</strong></a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../user_guide.html#advanced-topics">Advanced Topics</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Static Unit Coherence Checking and AST Modification</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-advantages">Performance Advantages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contribute.html">Contribute to impunity</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Impunity</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user_guide.html">User Guide</a></li>
      <li class="breadcrumb-item active">Static Unit Coherence Checking and AST Modification</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user_guide/perf_improvement.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="static-unit-coherence-checking-and-ast-modification">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Static Unit Coherence Checking and AST Modification</a><a class="headerlink" href="#static-unit-coherence-checking-and-ast-modification" title="Permalink to this heading"></a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#static-unit-coherence-checking-and-ast-modification" id="id1">Static Unit Coherence Checking and AST Modification</a></p>
<ul>
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#performance-advantages" id="id3">Performance Advantages</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id4">Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#example-1-loop-with-dynamic-conversion-using-pint" id="id5">Example 1: Loop with Dynamic Conversion using Pint</a></p></li>
<li><p><a class="reference internal" href="#example-2-loop-with-static-coherence-checking-and-ast-modification" id="id6">Example 2: Loop with Static Coherence Checking and AST Modification</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#conclusion" id="id7">Conclusion</a></p></li>
</ul>
</li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<p>In the <strong>Impunity</strong> library, we emphasize the importance of statically
checking unit coherence and modifying the Abstract Syntax Tree (AST)
for improved performance. This advanced topic explains why this approach
is superior to dynamic methods, such as using if statements directly
with the Pint library.</p>
</section>
<section id="performance-advantages">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Performance Advantages</a><a class="headerlink" href="#performance-advantages" title="Permalink to this heading"></a></h2>
<p>Statically checking unit coherence and modifying the AST offers several
performance advantages over dynamic approaches. Let’s explore these
advantages in detail:</p>
<ol class="arabic">
<li><p>Early Detection of Unit Inconsistencies:</p>
<p>Static analysis of annotations allows for early detection of unit
inconsistencies during the compilation phase. This enables developers
to catch and address unit errors before executing the code. In contrast,
dynamic methods relying on if statements and Pint conversions only identify
unit inconsistencies at runtime, potentially causing errors during execution.</p>
</li>
<li><p>Efficient and Optimized Execution:</p>
<p>By modifying the AST, <strong>Impunity</strong> ensures that the code executes with
coherent units, eliminating the need for runtime unit conversions. This
results in more efficient and optimized execution, as the conversions are
handled during the compilation process rather than repeatedly during runtime.</p>
</li>
<li><p>Reduced Overhead and Computational Costs:</p>
<p>Statically checking the coherence of units and applying conversions at
compile-time significantly reduces the overhead and computational costs
associated with dynamic conversions. This can lead to improved performance,
especially in code segments that involve complex calculations or loops.</p>
</li>
</ol>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Examples</a><a class="headerlink" href="#examples" title="Permalink to this heading"></a></h2>
<p>To better understand the performance advantages of static unit coherence
checking and AST modification, let’s consider a couple of examples:</p>
<section id="example-1-loop-with-dynamic-conversion-using-pint">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Example 1: Loop with Dynamic Conversion using Pint</a><a class="headerlink" href="#example-1-loop-with-dynamic-conversion-using-pint" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pint</span>

<span class="n">ureg</span> <span class="o">=</span> <span class="n">pint</span><span class="o">.</span><span class="n">UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span>

<span class="k">def</span> <span class="nf">calculate_velocity</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="s2">&quot;feet&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="s2">&quot;minutes&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ft / mn&quot;</span><span class="p">:</span>
    <span class="n">converted_distance</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">ureg</span><span class="o">.</span><span class="n">feet</span><span class="p">)</span>
    <span class="n">converted_time</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">ureg</span><span class="o">.</span><span class="n">minutes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">converted_distance</span> <span class="o">/</span> <span class="n">converted_time</span>

<span class="n">distance</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">ureg</span><span class="o">.</span><span class="n">meter</span><span class="p">)</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">ureg</span><span class="o">.</span><span class="n">second</span><span class="p">)</span>

<span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
    <span class="n">velocity</span> <span class="o">=</span> <span class="n">calculate_velocity</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, a loop iterates over lists of <cite>distance</cite> and <cite>time</cite>
values. To perform unit conversion, each value is multiplied by the
respective Pint unit (<cite>ureg.feet</cite> and <cite>ureg.minutes</cite>). The overhead of
repeatedly performing conversions within the loop can impact performance,
especially for large datasets as it needs to check each value one by one.
It is also prone to Dimensionality Errors if <cite>calculate_velocity</cite> is not given
a length quantity.</p>
</section>
<section id="example-2-loop-with-static-coherence-checking-and-ast-modification">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Example 2: Loop with Static Coherence Checking and AST Modification</a><a class="headerlink" href="#example-2-loop-with-static-coherence-checking-and-ast-modification" title="Permalink to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">impunity</span> <span class="kn">import</span> <span class="n">impunity</span>

<span class="nd">@impunity</span>
<span class="k">def</span> <span class="nf">calculate_velocity</span><span class="p">(</span><span class="n">distance</span><span class="p">:</span> <span class="s2">&quot;feet&quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="s2">&quot;minutes&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ft / mn&quot;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">distance</span> <span class="o">/</span> <span class="n">time</span>

<span class="nd">@impunity</span>
<span class="k">def</span> <span class="nf">test_impunity</span><span class="p">():</span>
    <span class="n">distance</span><span class="p">:</span> <span class="s2">&quot;meters&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">time</span><span class="p">:</span> <span class="s2">&quot;seconds&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="n">time</span><span class="p">):</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">calculate_velocity</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">velocity</span><span class="p">)</span>

<span class="n">test_impunity</span><span class="p">()</span>
</pre></div>
</div>
<p>In this example, the <cite>calculate_velocity</cite> function is decorated with
<cite>&#64;impunity</cite> to ensure unit coherence. The loop iterates over the lists
of <cite>distance</cite> and <cite>time</cite>, invoking the decorated function for each pair.
The static unit coherence checking and AST modification performed by
<strong>Impunity</strong> eliminate the need for explicit conversions within the
loop, resulting in improved performance.</p>
</section>
</section>
<section id="conclusion">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Conclusion</a><a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p>Static unit coherence checking and AST modification provided by the
<strong>Impunity</strong> library offer significant performance advantages over
dynamic approaches. By detecting unit inconsistencies early, ensuring
efficient execution, and reducing overhead and computational costs,
<strong>Impunity</strong> enables developers to work with coherent units
seamlessly and achieve optimal performance.</p>
<p>By adopting static coherence checking and AST modification,
you can enhance the performance of your code, especially
in scenarios involving complex calculations, loops, and large datasets.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="decorator_options.html" class="btn btn-neutral float-left" title="Decorator Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../contribute.html" class="btn btn-neutral float-right" title="Contribute to impunity" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Antoine Chevrot.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>